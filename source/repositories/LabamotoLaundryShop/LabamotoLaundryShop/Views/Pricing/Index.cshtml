@model LabamotoLaundryShop.Models.PricingViewModel
@{
    ViewBag.Title = "Pricing & Service Configuration";
    Layout = "~/Views/Shared/_OwnerLayout.cshtml";
    // Set default tab to RegularLaundry
    string currentAction = ViewContext.RouteData.Values["action"]?.ToString();
    if (string.IsNullOrEmpty(currentAction))
    {
        currentAction = "RegularLaundry";
    }
}

<style>
    /* Modern tab-style buttons */
    .pricing-tabs {
        display: flex;
        width: 100%;
        gap: 6px;
        margin-bottom: 1rem;
    }

    .pricing-tab {
        flex: 1;
        padding: 0.5rem 0;
        border: none;
        background: transparent;
        font-weight: 500;
        font-size: 0.95rem;
        cursor: pointer;
        position: relative;
        transition: color 0.2s;
        border: 1px solid blue;
    }

        .pricing-tab.active {
            color: #0d6efd;
        }

            .pricing-tab.active::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 3px;
                background-color: #0d6efd;
                border-radius: 3px 3px 0 0;
            }
</style>

<div class="container mt-4">
    <div class="pricing-container p-3 shadow-sm bg-white rounded">

        <a href="@Url.Action("Dashboard", "Owner")" class="btn btn-outline-secondary mb-3">← Back</a>

        <h4 class="fw-bold mb-2 text-primary">Pricing & Service Configuration</h4>
        <p class="text-muted mb-4">Configure pricing and services. Changes will immediately reflect in staff order forms.</p>

        <!-- Category Buttons as Modern Tabs -->
        <div class="pricing-tabs">
            <button class="pricing-tab @(currentAction=="RegularLaundry"?"active":"")"
                    onclick="location.href='@Url.Action("RegularLaundry","Pricing")'">
                🧺 Regular Laundry
            </button>
            
            <button class="pricing-tab @(currentAction=="SpecialItems"?"active":"")"
                    onclick="location.href='@Url.Action("SpecialItems","Pricing")'">
                👕 Special Items
            </button>
            <button class="pricing-tab @(currentAction=="DryClean"?"active":"")"
                    onclick="location.href='@Url.Action("DryClean","Pricing")'">
                🧥 Dry Clean
            </button>
            <button class="pricing-tab @(currentAction=="AddOns"?"active":"")"
                    onclick="location.href='@Url.Action("AddOns","Pricing")'">
                🧴 Add-ons & Fees
            </button>
        </div>


        <form method="post" class="w-100">
            <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
                <h5 class="fw-semibold text-dark mb-2">
                    @switch (currentAction)
                    {
                        case "RegularLaundry":
                            @:Regular Laundry Service (by kg);
                            break;
                        case "SpecialItems":
                            @:Special Items Service;
                            break;
                        case "DryClean":
                            @:Dry Clean Service;
                            break;
                        case "AddOns":
                            @:Add-ons & Fees;
                            break;
                        default:
                            @:Service Packages;
                            break;
                    }
                </h5>

                @* Show appropriate Add button based on tab *@
                @if (currentAction == "RegularLaundry")
                {
                    <button type="button" class="btn btn-primary shadow-sm" data-bs-toggle="modal" data-bs-target="#addRegularModal">
                        + Add New Package
                    </button>
                }
                else if (currentAction == "SpecialItems")
                {
                    <button type="button" class="btn btn-primary shadow-sm" data-bs-toggle="modal" data-bs-target="#addSpecialModal">
                        + Add New Item Type
                    </button>
                }
                else if (currentAction == "DryClean")
                {
                    <button type="button" class="btn btn-primary shadow-sm" data-bs-toggle="modal" data-bs-target="#addDryCleanModal">
                        + Add New Item Type
                    </button>
                }
                else if (currentAction == "AddOns")
                {
                    <button type="button" class="btn btn-primary shadow-sm" data-bs-toggle="modal" data-bs-target="#addAddOnModal">
                        + Add New Service
                    </button>
                }
            </div>

            <div class="table-responsive">
                @* Regular Laundry Table (default) *@
                @if (currentAction == "RegularLaundry")
                {
                    <table class="table table-bordered table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Service Package</th>
                                <th>Price per kg</th>
                                <th>Min. Weight</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.RegularLaundry)
                            {
                                <tr>
                                    <td>@item.PackageName</td>
                                    <td>₱ @item.PricePerKg.ToString("N2")</td>
                                    <td>@item.MinimumKg kg</td>
                                    <td>@item.Status</td>
                                    <td>
                                        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editRegular-@item.PackageID">✏️ Edit</button>
                                        <a href="@Url.Action("TogglePackageStatus","Pricing", new { PackageID=item.PackageID })" class="btn btn-outline-warning btn-sm">🔁 Toggle</a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }

                @* Special Items Table *@
                @if (currentAction == "SpecialItems")
                {
                    <table class="table table-bordered table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Item Type</th>
                                <th>Category</th>
                                <th>Price per pc</th>
                                <th>Processing Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.SpecialItems)
                            {
                                <tr>
                                    <td>@item.ItemName</td>
                                    <td>@item.Category</td>
                                    <td>₱ @item.PricePerPiece.ToString("N2")</td>
                                    <td>@item.ProcessingTime</td>
                                    <td>@item.Status</td>
                                    <td>
                                        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editSpecial-@item.SpecialItemID">✏️ Edit</button>
                                        <a href="@Url.Action("DeleteSpecialItem","Pricing", new { SpecialItemID=item.SpecialItemID })" class="btn btn-outline-danger btn-sm">🗑 Delete</a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }

                @* Dry Clean Table *@
                @if (currentAction == "DryClean")
                {
                    <table class="table table-bordered table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Item Type</th>
                                <th>Price per pc</th>
                                <th>Processing Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.DryClean)
                            {
                                <tr>
                                    <td>@item.ItemName</td>
                                    <td>₱ @item.PricePerPiece.ToString("N2")</td>
                                    <td>@item.ProcessingTime</td>
                                    <td>@item.Status</td>
                                    <td>
                                        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editDryClean-@item.DryCleanItemID">✏️ Edit</button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }

                @* Add-ons & Fees Table *@
                @if (currentAction == "AddOns")
                {
                    <table class="table table-bordered table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Service Name</th>
                                <th>Price Type</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.AddOns)
                            {
                                <tr>
                                    <td>@item.ServiceName</td>
                                    <td>@item.PriceType</td>
                                    <td>@item.Price</td>
                                    <td>@item.Status</td>
                                    <td>
                                        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editAddOn-@item.AddOnID">✏️ Edit</button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>
        </form>


        <!-- Export & Import Buttons -->
        <div class="d-flex flex-column flex-md-row justify-content-between mt-4 gap-2">
            <a href="@Url.Action("ExportPDF", "Pricing")" class="btn btn-outline-dark w-100 w-md-50 shadow-sm">Export Pricing List (PDF)</a>

            <form class="import-form w-100 w-md-50 shadow-sm" method="post" enctype="multipart/form-data" action="@Url.Action("ImportCSV", "Pricing")">
                <label class="btn btn-outline-secondary w-100 mb-0">
                    Import Pricing (CSV)
                    <input type="file" name="file" onchange="this.form.submit()" />
                </label>
            </form>
        </div>
    </div>
</div>
@* =====================
    ADD NEW MODALS
    ===================== *@

@* Add Regular Laundry Package *@
<div class="modal fade" id="addRegularModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Add New Service Package</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="@Url.Action("AddPackage","Pricing")">
                <div class="modal-body">
                    <div class="mb-3">
                        <label>Service Name</label>
                        <input type="text" name="PackageName" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Price (₱ per kg)</label>
                        <input type="number" step="0.01" name="PricePerKg" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Unit</label>
                        <select name="Unit" class="form-select" required>
                            <option value="kg">kg</option>
                            <option value="pc">pc</option>
                            <option value="set">set</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label>Minimum Weight/Quantity</label>
                        <input type="number" step="0.01" name="MinimumKg" class="form-control" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Package</button>
                </div>
            </form>
        </div>
    </div>
</div>

@* Add Special Item *@
<div class="modal fade" id="addSpecialModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Add New Special Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="@Url.Action("AddSpecialItem","Pricing")">
                <div class="modal-body">
                    <div class="mb-3">
                        <label>Item Type</label>
                        <input type="text" name="ItemName" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Category</label>
                        <input type="text" name="Category" class="form-control" />
                    </div>
                    <div class="mb-3">
                        <label>Price per pc (₱)</label>
                        <input type="number" step="0.01" name="PricePerPiece" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Processing Time</label>
                        <input type="text" name="ProcessingTime" class="form-control" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Item</button>
                </div>
            </form>
        </div>
    </div>
</div>

@* Add Dry Clean Item *@
<div class="modal fade" id="addDryCleanModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Add New Dry Clean Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="@Url.Action("AddDryClean","Pricing")">
                <div class="modal-body">
                    <div class="mb-3">
                        <label>Item Type</label>
                        <input type="text" name="ItemName" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Price per pc (₱)</label>
                        <input type="number" step="0.01" name="PricePerPiece" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Processing Time</label>
                        <input type="text" name="ProcessingTime" class="form-control" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Item</button>
                </div>
            </form>
        </div>
    </div>
</div>

@* Add Add-on / Fee *@
<div class="modal fade" id="addAddOnModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Add New Add-on / Fee</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="@Url.Action("AddAddOn","Pricing")">
                <div class="modal-body">
                    <div class="mb-3">
                        <label>Service Name</label>
                        <input type="text" name="ServiceName" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Price Type</label>
                        <input type="text" name="PriceType" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Price</label>
                        <input type="number" step="0.01" name="Price" class="form-control" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Service</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODALS -->
@* Regular Laundry Modals *@
@foreach (var item in Model.RegularLaundry)
{
    <div class="modal fade" id="editRegular-@item.PackageID" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Edit Regular Laundry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="post" action="@Url.Action("EditPackage","Pricing")">
                    <div class="modal-body">
                        <input type="hidden" name="PackageID" value="@item.PackageID" />
                        <div class="mb-3">
                            <label>Service/Item Name</label>
                            <input type="text" name="PackageName" class="form-control" value="@item.PackageName" />
                        </div>
                        <div class="mb-3">
                            <label>Price (₱)</label>
                            <input type="number" step="0.01" name="PricePerKg" class="form-control" value="@item.PricePerKg" />
                        </div>
                        <div class="mb-3">
                            <label>Unit</label>
                            <select name="Unit" class="form-select">
                                <option value="kg" @(item.Unit == "kg" ? "selected" : "")>kg</option>
                                <option value="pc" @(item.Unit == "pc" ? "selected" : "")>pc</option>
                                <option value="set" @(item.Unit == "set" ? "selected" : "")>set</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label>Minimum Weight/Quantity</label>
                            <input type="number" step="0.01" name="MinimumKg" class="form-control" value="@item.MinimumKg" />
                        </div>
                        <div class="mb-3">
                            <label>Status</label>
                            <select name="Status" class="form-select">
                                <option value="Active" @(item.Status == "Active" ? "selected" : "")>Active</option>
                                <option value="Inactive" @(item.Status == "Inactive" ? "selected" : "")>Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button class="btn btn-primary" type="submit">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}

@* Special Items Modals *@
@foreach (var item in Model.SpecialItems)
{
    <div class="modal fade" id="editSpecial-@item.SpecialItemID" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Edit Special Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="post" action="@Url.Action("EditSpecialItem","Pricing")">
                    <div class="modal-body">
                        <input type="hidden" name="SpecialItemID" value="@item.SpecialItemID" />
                        <div class="mb-3">
                            <label>Item Name</label>
                            <input type="text" name="ItemName" class="form-control" value="@item.ItemName" required />
                        </div>
                        <div class="mb-3">
                            <label>Category</label>
                            <input type="text" name="Category" class="form-control" value="@item.Category" />
                        </div>
                        <div class="mb-3">
                            <label>Price per Piece (₱)</label>
                            <input type="number" step="0.01" name="PricePerPiece" class="form-control" value="@item.PricePerPiece" required />
                        </div>
                        <div class="mb-3">
                            <label>Processing Time</label>
                            <input type="text" name="ProcessingTime" class="form-control" value="@item.ProcessingTime" />
                        </div>
                        <div class="mb-3">
                            <label>Status</label>
                            <select name="Status" class="form-select">
                                <option value="Active" @(item.Status == "Active" ? "selected" : "")>Active</option>
                                <option value="Inactive" @(item.Status == "Inactive" ? "selected" : "")>Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button class="btn btn-primary" type="submit">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}

@* Dry Clean Modals *@
@foreach (var item in Model.DryClean)
{
    <div class="modal fade" id="editDryClean-@item.DryCleanItemID" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Edit Dry Clean Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="post" action="@Url.Action("EditDryClean","Pricing")">
                    <div class="modal-body">
                        <input type="hidden" name="DryCleanItemID" value="@item.DryCleanItemID" />
                        <div class="mb-3">
                            <label>Item Name</label>
                            <input type="text" name="ItemName" class="form-control" value="@item.ItemName" required />
                        </div>
                        <div class="mb-3">
                            <label>Price per Piece (₱)</label>
                            <input type="number" step="0.01" name="PricePerPiece" class="form-control" value="@item.PricePerPiece" required />
                        </div>
                        <div class="mb-3">
                            <label>Processing Time</label>
                            <input type="text" name="ProcessingTime" class="form-control" value="@item.ProcessingTime" />
                        </div>
                        <div class="mb-3">
                            <label>Status</label>
                            <select name="Status" class="form-select">
                                <option value="Active" @(item.Status == "Active" ? "selected" : "")>Active</option>
                                <option value="Inactive" @(item.Status == "Inactive" ? "selected" : "")>Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button class="btn btn-primary" type="submit">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}

@* Add-ons & Fees Modals *@
@foreach (var item in Model.AddOns)
{
    <div class="modal fade" id="editAddOn-@item.AddOnID" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Edit Add-on / Fee</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="post" action="@Url.Action("EditAddOn","Pricing")">
                    <div class="modal-body">
                        <input type="hidden" name="AddOnID" value="@item.AddOnID" />
                        <div class="mb-3">
                            <label>Service Name</label>
                            <input type="text" name="ServiceName" class="form-control" value="@item.ServiceName" required />
                        </div>
                        <div class="mb-3">
                            <label>Price Type</label>
                            <input type="text" name="PriceType" class="form-control" value="@item.PriceType" />
                        </div>
                        <div class="mb-3">
                            <label>Price (₱)</label>
                            <input type="number" step="0.01" name="Price" class="form-control" value="@item.Price" required />
                        </div>
                        <div class="mb-3">
                            <label>Status</label>
                            <select name="Status" class="form-select">
                                <option value="Active" @(item.Status == "Active" ? "selected" : "")>Active</option>
                                <option value="Inactive" @(item.Status == "Inactive" ? "selected" : "")>Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button class="btn btn-primary" type="submit">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}
